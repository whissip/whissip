/*
* bubbletip
*
* Copyright (c) 2009-2010, UhLeeKa.
* Version: 
*      1.0.6
* Licensed under the GNU Lesser General Public License:
*     http://www.gnu.org/licenses/lgpl-3.0.html
* Author Website: 
*     http://www.uhleeka.com
* Project Hosting on Google Code: 
*     http://code.google.com/p/bubbletip/
*/
(function(a){var b=0;a.fn.extend({bubbletip:function(c,d){function t(){if(h.positionAt.match(/^element$/i)){var a=h.positionAtElement.offset();if(h.deltaDirection.match(/^up$/i)){i.top=a.top+h.offsetTop-n.outerHeight();i.left=a.left+h.offsetLeft+(h.positionAtElement.outerWidth()-n.outerWidth())/2;i.delta=h.deltaPosition}else if(h.deltaDirection.match(/^down$/i)){i.top=a.top+h.positionAtElement.outerHeight()+h.offsetTop;i.left=a.left+h.offsetLeft+(h.positionAtElement.outerWidth()-n.outerWidth())/2;i.delta=-h.deltaPosition}else if(h.deltaDirection.match(/^left$/i)){i.top=a.top+h.offsetTop+(h.positionAtElement.outerHeight()-n.outerHeight())/2;i.left=a.left+h.offsetLeft-n.outerWidth();i.delta=h.deltaPosition}else if(h.deltaDirection.match(/^right$/i)){i.top=a.top+h.offsetTop+(h.positionAtElement.outerHeight()-n.outerHeight())/2;i.left=a.left+h.positionAtElement.outerWidth()+h.offsetLeft;i.delta=-h.deltaPosition}}else if(h.positionAt.match(/^body$/i)){if(h.deltaDirection.match(/^up|left$/i)){i.top=h.offsetTop;i.left=h.offsetLeft;i.delta=h.deltaPosition}else{if(h.deltaDirection.match(/^down$/i)){i.top=parseInt(h.offsetTop+n.outerHeight());i.left=h.offsetLeft}else{i.top=h.offsetTop;i.left=parseInt(h.offsetLeft+n.outerWidth())}i.delta=-h.deltaPosition}}else if(h.positionAt.match(/^mouse$/i)){if(h.deltaDirection.match(/^up|left$/i)){if(h.deltaDirection.match(/^up$/i)){i.top=-(h.offsetTop+n.outerHeight());i.left=h.offsetLeft}else if(h.deltaDirection.match(/^left$/i)){i.top=h.offsetTop;i.left=-(h.offsetLeft+n.outerWidth())}i.delta=h.deltaPosition}else{i.top=h.offsetTop;i.left=h.offsetLeft;i.delta=-h.deltaPosition}}if(h.positionAt.match(/^element|body$/i)){n.css({position:"absolute",top:i.top+"px",left:i.left+"px"})}}function s(){var b;l=false;m=true;if(h.positionAt.match(/^element|body$/i)){if(h.deltaDirection.match(/^up|down$/i)){b={top:parseInt(i.top-i.delta)+"px"}}else{b={left:parseInt(i.left-i.delta)+"px"}}}else{if(h.deltaDirection.match(/^up|down$/i)){b={top:parseInt(i.mouseTop-i.delta)+"px"}}else{b={left:parseInt(i.mouseLeft-i.delta)+"px"}}}b=a.extend(b,{opacity:0});n.animate(b,h.animationDuration,h.animationEasing,function(){n.hide();m=false})}function r(){var b;if(l){return}l=true;if(m){n.stop(true,false)}if(h.calculateOnShow){t()}if(h.positionAt.match(/^element|body$/i)){if(h.deltaDirection.match(/^up|down$/i)){if(!m){n.css("top",parseInt(i.top+i.delta)+"px")}b={top:i.top+"px"}}else{if(!m){n.css("left",parseInt(i.left+i.delta)+"px")}b={left:i.left+"px"}}}else{if(h.deltaDirection.match(/^up|down$/i)){if(!m){i.mouseTop=e.pageY+i.top;n.css({top:parseInt(i.mouseTop+i.delta)+"px",left:parseInt(e.pageX-n.width()/2)+"px"})}b={top:i.mouseTop+"px"}}else{if(!m){i.mouseLeft=e.pageX+i.left;n.css({left:parseInt(i.mouseLeft+i.delta)+"px",top:parseInt(e.pageY-n.height()/2)+"px"})}b={left:i.left+"px"}}}m=false;n.show();b=a.extend(b,{opacity:1});n.animate(b,h.animationDuration,h.animationEasing,function(){n.css("opacity","");l=true})}if(a("table.bubbletip #"+a(c).get(0).id).length>0){return this}var f,g,h,i,j,k,l,m,n,o;var p,q;f=a(this);g=a(c);o=b++;h={positionAt:"element",positionAtElement:f,offsetTop:0,offsetLeft:0,deltaPosition:30,deltaDirection:"up",animationDuration:250,animationEasing:"swing",bindShow:"mouseover",bindHide:"mouseout",delayShow:0,delayHide:500,calculateOnShow:false};if(d){h=a.extend(h,d)}i={top:0,left:0,delta:0,mouseTop:0,mouseLeft:0,tipHeight:0,bindShow:(h.bindShow+" ").replace(/ +/g,".bubbletip"+o),bindHide:(h.bindHide+" ").replace(/ +/g,".bubbletip"+o)};j=null;k=null;l=false;m=false;if(!f.data("bubbletip_tips")){f.data("bubbletip_tips",[[g.get(0).id,o]])}else{f.data("bubbletip_tips",a.merge(f.data("bubbletip_tips"),[[g.get(0).id,o]]))}if(!h.positionAt.match(/^element|body|mouse$/i)){h.positionAt="element"}if(!h.deltaDirection.match(/^up|down|left|right$/i)){h.deltaDirection="up"}if(h.deltaDirection.match(/^up$/i)){n=a('<table class="bubbletip" cellspacing="0" cellpadding="0"><tbody><tr><td class="bt-topleft"></td><td class="bt-top"></td><td class="bt-topright"></td></tr><tr><td class="bt-left"></td><td class="bt-content"></td><td class="bt-right"></td></tr><tr><td class="bt-bottomleft"></td><td><table class="bt-bottom" cellspacing="0" cellpadding="0"><tr><th></th><td><div></div></td><th></th></tr></table></td><td class="bt-bottomright"></td></tr></tbody></table>')}else if(h.deltaDirection.match(/^down$/i)){n=a('<table class="bubbletip" cellspacing="0" cellpadding="0"><tbody><tr><td class="bt-topleft"></td><td><table class="bt-top" cellspacing="0" cellpadding="0"><tr><th></th><td><div></div></td><th></th></tr></table></td><td class="bt-topright"></td></tr><tr><td class="bt-left"></td><td class="bt-content"></td><td class="bt-right"></td></tr><tr><td class="bt-bottomleft"></td><td class="bt-bottom"></td><td class="bt-bottomright"></td></tr></tbody></table>')}else if(h.deltaDirection.match(/^left$/i)){n=a('<table class="bubbletip" cellspacing="0" cellpadding="0"><tbody><tr><td class="bt-topleft"></td><td class="bt-top"></td><td class="bt-topright"></td></tr><tr><td class="bt-left"></td><td class="bt-content"></td><td class="bt-right-tail"><div class="bt-right"></div><div class="bt-right-tail"></div><div class="bt-right"></div></td></tr><tr><td class="bt-bottomleft"></td><td class="bt-bottom"></td><td class="bt-bottomright"></td></tr></tbody></table>')}else if(h.deltaDirection.match(/^right$/i)){n=a('<table class="bubbletip" cellspacing="0" cellpadding="0"><tbody><tr><td class="bt-topleft"></td><td class="bt-top"></td><td class="bt-topright"></td></tr><tr><td class="bt-left-tail"><div class="bt-left"></div><div class="bt-left-tail"></div><div class="bt-left"></div></td><td class="bt-content"></td><td class="bt-right"></td></tr><tr><td class="bt-bottomleft"></td><td class="bt-bottom"></td><td class="bt-bottomright"></td></tr></tbody></table>')}n.appendTo("body");if(/msie/.test(navigator.userAgent.toLowerCase())&&!/opera/.test(navigator.userAgent.toLowerCase())){a("*",n).each(function(){var b=a(this).css("background-image");if(b.match(/^url\(["']?(.*\.png)["']?\)$/i)){b=RegExp.$1;a(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod="+(a(this).css("backgroundRepeat")=="no-repeat"?"crop":"scale")+", src='"+b+"')"}).each(function(){var b=a(this).css("position");if(b!="absolute"&&b!="relative")a(this).css("position","relative")})}})}a(".bt-content",n).append(g);g.show();if(h.deltaDirection.match(/^left|right$/i)){i.tipHeight=parseInt(g.height()/2);if(g.height()%2==1){i.tipHeight++}i.tipHeight=i.tipHeight<20?1:i.tipHeight-20;if(h.deltaDirection.match(/^left$/i)){a("div.bt-right",n).css("height",i.tipHeight+"px")}else{a("div.bt-left",n).css("height",i.tipHeight+"px")}}n.css("opacity",0);n.css({width:n.width(),height:n.height()});t();n.hide();a(window).bind("resize.bubbletip"+o,function(){var b=a(window).width();var c=a(window).height();if(b===p&&c===q){return}p=b;q=c;if(k){clearTimeout(k)}k=setTimeout(function(){t()},250)});a([n.get(0),this.get(0)]).bind(i.bindShow,function(){if(j){clearTimeout(j)}if(h.delayShow===0){r()}else{j=setTimeout(function(){r()},h.delayShow)}return false}).bind(i.bindHide,function(){if(j){clearTimeout(j)}if(h.delayHide===0){s()}else{j=setTimeout(function(){s()},h.delayHide)}return false});return this},removeBubbletip:function(b){var c;var d=new Array;var e=new Array;var f,g,h;var i;c=a.makeArray(a(this).data("bubbletip_tips"));f=a.makeArray(b);for(g=0;g<f.length;g++){d.push(a(f[g]).get(0).id)}for(g=0;g<c.length;g++){h=null;if(d.length==0||(h=a.inArray(c[g][0],d))>=0){i=a("#"+c[g][0]).get(0).parentNode;while(i.tagName.toLowerCase()!="table"){i=i.parentNode}a("#"+c[g][0]).appendTo("body").hide();a(i).remove();a(this).unbind(".bubbletip"+c[g][1]);a(window).unbind(".bubbletip"+c[g][1])}else{e.push(c[g])}}a(this).data("bubbletip_tips",e);return this}})})(jQuery)